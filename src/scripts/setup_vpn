#!/bin/bash
#
# Example usage: setup-algo "External-IP-of-the-VPS"
#
# @todo - something not okay with PPA installations

declare -r ALGO_DIRECTORY="$HOME/git/algo"

if [ ! -d "$ALGO_DIRECTORY" ]; then
  git clone git@github.com:trailofbits/algo.git
fi

pushd "$ALGO_DIRECTORY" || exit &>/dev/null

git pull -q

python -m virtualenv --python="$(command -v python3)" .env &&
  source .env/bin/activate &&
  python3 -m pip install -U pip virtualenv &&
  python3 -m pip install -r requirements.txt

vi "$ALGO_DIRECTORY"/config.cfg

"$ALGO_DIRECTORY"/algo

deactivate

sudo ln -sf "$ALGO_DIRECTORY"/configs/"$1"/wireguard/joelazar.conf /etc/wireguard/wg0.conf

popd || exit &>/dev/null
