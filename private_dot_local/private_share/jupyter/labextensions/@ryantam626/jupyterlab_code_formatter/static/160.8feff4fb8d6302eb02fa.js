(self.webpackChunk_ryantam626_jupyterlab_code_formatter=self.webpackChunk_ryantam626_jupyterlab_code_formatter||[]).push([[160],{160:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>C});var o,s=r(840),a=r(635),n=r(67),i=r(82),l=r(897),c=r(810),d=r(834);!function(e){e.SHORT_PLUGIN_NAME="jupyterlab_code_formatter",e.FORMAT_COMMAND=`${e.SHORT_PLUGIN_NAME}:format`,e.FORMAT_ALL_COMMAND=`${e.SHORT_PLUGIN_NAME}:format_all`,e.ICON_FORMAT_ALL_SVG='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false" width="1em" height="1em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 1792 1792"><path class="jp-icon3" d="M1473 929q7-118-33-226.5t-113-189t-177-131T929 325q-116-7-225.5 32t-192 110.5t-135 175T317 863q-7 118 33 226.5t113 189t177.5 131T862 1467q155 9 293-59t224-195.5t94-283.5zM1792 0l-349 348q120 117 180.5 272t50.5 321q-11 183-102 339t-241 255.5T999 1660L0 1792l347-347q-120-116-180.5-271.5T116 852q11-184 102-340t241.5-255.5T792 132q167-22 500-66t500-66z" fill="#626262"/></svg>',e.ICON_FORMAT_ALL="fa fa-superpowers",e.LONG_PLUGIN_NAME=`@ryantam626/${e.SHORT_PLUGIN_NAME}`,e.SETTINGS_SECTION=`${e.LONG_PLUGIN_NAME}:settings`,e.COMMAND_SECTION_NAME="Jupyterlab Code Formatter",e.PLUGIN_VERSION="1.4.1"}(o||(o={}));class u{constructor(e){this.client=e}formatCode(e,t,r,o){return this.client.request("format","POST",JSON.stringify({code:e,notebook:o,formatter:t,options:r})).then((e=>JSON.parse(e)))}}class h extends u{constructor(e,t){super(e),this.notebookTracker=t}async formatAction(e,t){return this.formatCells(!0,e,t)}async formatSelectedCodeCells(e,t,r){return this.formatCells(!0,e,t,r)}async formatAllCodeCells(e,t,r){return this.formatCells(!1,e,t,r)}getCodeCells(e=!0,t){if(!this.notebookTracker.currentWidget)return[];const r=[];return(t=t||this.notebookTracker.currentWidget.content).widgets.forEach((o=>{"code"===o.model.type&&(e&&!t.isSelectedOrActive(o)||r.push(o))})),r}getNotebookType(){if(!this.notebookTracker.currentWidget)return null;const e=this.notebookTracker.currentWidget.content.model.metadata.toJSON();return e?e.kernelspec&&e.kernelspec.language?e.kernelspec.language.toLowerCase():e.language_info&&e.language_info.codemirror_mode?e.language_info.codemirror_mode.name.toLowerCase():null:null}getDefaultFormatters(e){const t=this.getNotebookType();if(t){const r=e.preferences.default_formatter[t];if(r instanceof Array)return r;if(void 0!==r)return[r]}return[]}async formatCells(e,t,r,o){if(!this.working){try{this.working=!0;const s=this.getCodeCells(e,o);if(0===s.length)return void(this.working=!1);const n=this.getDefaultFormatters(t),i=void 0!==r?[r]:n;0===i.length&&await(0,a.showErrorMessage)("Jupyterlab Code Formatter Error","Unable to find default formatters to use, please file an issue on GitHub.");for(let e of i){const r=s.map((e=>e.model.value.text)),o=await this.formatCode(r,e,t[e],!0);for(let e=0;e<s.length;++e){const t=s[e],n=r[e],i=o.code[e];t.model.value.text===n?i.error?await(0,a.showErrorMessage)("Jupyterlab Code Formatter Error",i.error):t.model.value.text=i.code:await(0,a.showErrorMessage)("Jupyterlab Code Formatter Error",`Cell value changed since format request was sent, formatting for cell ${e} skipped.`)}}}catch(e){await(0,a.showErrorMessage)("Jupyterlab Code Formatter Error",e)}this.working=!1}}applicable(e,t){const r=this.notebookTracker.currentWidget;return r&&t===r}}class m extends u{constructor(e,t){super(e),this.editorTracker=t}formatAction(e,t){if(this.working)return;const r=this.editorTracker.currentWidget;this.working=!0;const o=r.content.editor.model.value.text;this.formatCode([o],t,e[t],!1).then((e=>{if(e.code[0].error)return(0,a.showErrorMessage)("Jupyterlab Code Formatter Error",e.code[0].error),void(this.working=!1);this.editorTracker.currentWidget.content.editor.model.value.text=e.code[0].code,this.working=!1})).catch((e=>{this.working=!1,(0,a.showErrorMessage)("Jupyterlab Code Formatter Error",e)}))}applicable(e,t){const r=this.editorTracker.currentWidget;return r&&t===r}}var p=r(129),g=r(173);class f{constructor(e,t,r,s,a,n){this.app=e,this.tracker=t,this.editorTracker=n,this.palette=r,this.settingRegistry=s,this.menu=a,this.client=new class{request(e,t,r){const s=d.ServerConnection.makeSettings(),a=c.URLExt.join(s.baseUrl,o.SHORT_PLUGIN_NAME,e);return d.ServerConnection.makeRequest(a,{body:r,method:t,headers:new Headers({"Plugin-Version":o.PLUGIN_VERSION})},s).then((e=>200!==e.status?e.text().then((()=>{throw new d.ServerConnection.ResponseError(e,e.statusText)})):e.text()))}getAvailableFormatters(){return this.request("formatters","GET",null)}getVersion(){return this.request("version","GET",null)}},this.notebookCodeFormatter=new h(this.client,this.tracker),this.fileEditorCodeFormatter=new m(this.client,this.editorTracker),this.checkVersion().then((e=>{e&&(this.setupSettings(),this.setupAllCommands(),this.setupContextMenu(),this.setupWidgetExtension())}))}createNew(e,t){const r=this,s=new a.ToolbarButton({tooltip:"Format notebook",icon:new g.LabIcon({name:o.FORMAT_ALL_COMMAND,svgstr:o.ICON_FORMAT_ALL_SVG}),onClick:async()=>{await r.notebookCodeFormatter.formatAllCodeCells(this.config,void 0,e.content)}});return e.toolbar.insertAfter("cellType",this.app.commands.label(o.FORMAT_ALL_COMMAND),s),new p.DisposableDelegate((()=>{s.dispose()}))}setupWidgetExtension(){this.app.docRegistry.addWidgetExtension("Notebook",this)}setupContextMenu(){this.app.contextMenu.addItem({command:o.FORMAT_COMMAND,selector:".jp-Notebook"})}setupAllCommands(){this.client.getAvailableFormatters().then((e=>{const t=JSON.parse(e).formatters,r=[];Object.keys(t).forEach((e=>{if(t[e].enabled){const s=`${o.SHORT_PLUGIN_NAME}:${e}`;this.setupCommand(e,t[e].label,s),r.push({command:s})}})),this.menu.editMenu.addGroup(r)})),this.app.commands.addCommand(o.FORMAT_COMMAND,{execute:async()=>{await this.notebookCodeFormatter.formatSelectedCodeCells(this.config)},label:"Format cell"}),this.app.commands.addCommand(o.FORMAT_ALL_COMMAND,{execute:async()=>{await this.notebookCodeFormatter.formatAllCodeCells(this.config)},iconClass:o.ICON_FORMAT_ALL,iconLabel:"Format notebook"})}setupSettings(){const e=this;Promise.all([this.settingRegistry.load(o.SETTINGS_SECTION)]).then((([t])=>{function r(t){e.config=t.composite}t.changed.connect(r),r(t)})).catch((e=>{(0,a.showErrorMessage)("Jupyterlab Code Formatter Error",e)}))}setupCommand(e,t,r){this.app.commands.addCommand(r,{execute:async()=>{for(let t of[this.notebookCodeFormatter,this.fileEditorCodeFormatter])t.applicable(e,this.app.shell.currentWidget)&&await t.formatAction(this.config,e)},isVisible:()=>{for(let t of[this.notebookCodeFormatter,this.fileEditorCodeFormatter])if(t.applicable(e,this.app.shell.currentWidget))return!0;return!1},label:t}),this.palette.addItem({command:r,category:o.COMMAND_SECTION_NAME})}async checkVersion(){return this.client.getVersion().then((e=>{let t=JSON.parse(e).version,r=t===o.PLUGIN_VERSION;return r||(0,a.showErrorMessage)("Jupyterlab Code Formatter Version Mismatch",`Lab plugin version: ${o.PLUGIN_VERSION}. Server plugin version: ${t}. Please re-install the plugin with the latest instruction.`),r})).catch((e=>((0,a.showErrorMessage)("Jupyterlab Code Formatter Error","Unable to find server plugin version, this should be impossible,open a GitHub issue if you cannot figure this issue out yourself."),!1)))}}const C={activate:(e,t,r,o,s,a)=>{new f(e,r,t,o,s,a)},autoStart:!0,id:o.SHORT_PLUGIN_NAME,requires:[a.ICommandPalette,s.INotebookTracker,n.ISettingRegistry,i.IMainMenu,l.IEditorTracker]}}}]);