#!/bin/bash

# Get the list of displays
DISPLAYS=$(displayplacer list)

# Count the number of displays
DISPLAY_COUNT=$(echo "$DISPLAYS" | grep -c "Persistent screen id")

# Check the number of displays
if [ "$DISPLAY_COUNT" -eq 1 ]; then
  echo "Only one display detected. No action needed."
  exit 0
elif [ "$DISPLAY_COUNT" -eq 2 ]; then

  # Get the IDs of the two displays
  DISPLAY_IDS=($(echo "$DISPLAYS" | grep "Persistent screen id" | awk '{print $NF}'))

  # Get the current main display ID
  CURRENT_MAIN_DISPLAY=$(echo "$DISPLAYS" | grep -i "current main display" | awk '{print $NF}')

  # Determine the new main display ID
  if [ "$CURRENT_MAIN_DISPLAY" == "${DISPLAY_IDS[0]}" ]; then
    NEW_MAIN_DISPLAY="${DISPLAY_IDS[1]}"
    OLD_MAIN_DISPLAY="${DISPLAY_IDS[0]}"
  else
    NEW_MAIN_DISPLAY="${DISPLAY_IDS[0]}"
    OLD_MAIN_DISPLAY="${DISPLAY_IDS[1]}"
  fi

  # Get the resolutions and positions
  OLD_MAIN_DISPLAY_RES=$(echo "$DISPLAYS" | grep -A1 "$OLD_MAIN_DISPLAY" | tail -1)
  NEW_MAIN_DISPLAY_RES=$(echo "$DISPLAYS" | grep -A1 "$NEW_MAIN_DISPLAY" | tail -1)

  # Extract the position of the displays
  OLD_MAIN_DISPLAY_ORIGIN=$(echo "$OLD_MAIN_DISPLAY_RES" | grep -o 'origin:(-?[0-9]*,-?[0-9]*)')
  NEW_MAIN_DISPLAY_ORIGIN=$(echo "$NEW_MAIN_DISPLAY_RES" | grep -o 'origin:(-?[0-9]*,-?[0-9]*)')

  # Switch the main display and retain screen positions
  displayplacer "id:$NEW_MAIN_DISPLAY ${NEW_MAIN_DISPLAY_RES/$NEW_MAIN_DISPLAY_ORIGIN/origin:(0,0)}" "id:$OLD_MAIN_DISPLAY ${OLD_MAIN_DISPLAY_RES/$OLD_MAIN_DISPLAY_ORIGIN/$NEW_MAIN_DISPLAY_ORIGIN}"
else
  echo "Error: More than two displays detected. Exiting."
  exit 1
fi
